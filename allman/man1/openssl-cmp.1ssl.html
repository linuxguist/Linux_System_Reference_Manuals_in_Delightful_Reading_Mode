<pre><code></code></pre>
<p><br />
</p>
<link rel='stylesheet' href='../style.css'>
<script src='../script.js'></script>
<h1>NAME</h1>
<p>openssl-cmp - Certificate Management Protocol (CMP, RFC 4210)
application</p>
<h1>SYNOPSIS</h1>
<p><strong>openssl</strong> <strong>cmp</strong>
[<strong>-help</strong>] [<strong>-config</strong> <em>filename</em>]
[<strong>-section</strong> <em>names</em>] [<strong>-verbosity</strong>
<em>level</em>]</p>
<p>Generic message options:</p>
<p>[<strong>-cmd</strong> <em>ir|cr|kur|p10cr|rr|genm</em>]
[<strong>-infotype</strong> <em>name</em>] [<strong>-geninfo</strong>
<em>OID:int:N</em>]</p>
<p>Certificate enrollment options:</p>
<p>[<strong>-newkey</strong> <em>filename</em>|<em>uri</em>]
[<strong>-newkeypass</strong> <em>arg</em>] [<strong>-subject</strong>
<em>name</em>] [<strong>-issuer</strong> <em>name</em>]
[<strong>-days</strong> <em>number</em>] [<strong>-reqexts</strong>
<em>name</em>] [<strong>-sans</strong> <em>spec</em>]
[<strong>-san_nodefault</strong>] [<strong>-policies</strong>
<em>name</em>] [<strong>-policy_oids</strong> <em>names</em>]
[<strong>-policy_oids_critical</strong>] [<strong>-popo</strong>
<em>number</em>] [<strong>-csr</strong> <em>filename</em>]
[<strong>-out_trusted</strong> <em>filenames</em>|<em>uris</em>]
[<strong>-implicit_confirm</strong>] [<strong>-disable_confirm</strong>]
[<strong>-certout</strong> <em>filename</em>]
[<strong>-chainout</strong> <em>filename</em>]</p>
<p>Certificate enrollment and revocation options:</p>
<p>[<strong>-oldcert</strong> <em>filename</em>|<em>uri</em>]
[<strong>-revreason</strong> <em>number</em>]</p>
<p>Message transfer options:</p>
<p>[<strong>-server</strong>
<em>[http[s]://][userinfo@]host[:port][/path][?query][#fragment]</em>]
[<strong>-proxy</strong>
<em>[http[s]://][userinfo@]host[:port][/path][?query][#fragment]</em>]
[<strong>-no_proxy</strong> <em>addresses</em>]
[<strong>-recipient</strong> <em>name</em>] [<strong>-path</strong>
<em>remote_path</em>] [<strong>-keep_alive</strong> <em>value</em>]
[<strong>-msg_timeout</strong> <em>seconds</em>]
[<strong>-total_timeout</strong> <em>seconds</em>]</p>
<p>Server authentication options:</p>
<p>[<strong>-trusted</strong> <em>filenames</em>|<em>uris</em>]
[<strong>-untrusted</strong> <em>filenames</em>|<em>uris</em>]
[<strong>-srvcert</strong> <em>filename</em>|<em>uri</em>]
[<strong>-expect_sender</strong> <em>name</em>]
[<strong>-ignore_keyusage</strong>]
[<strong>-unprotected_errors</strong>] [<strong>-extracertsout</strong>
<em>filename</em>] [<strong>-cacertsout</strong> <em>filename</em>]</p>
<p>Client authentication and protection options:</p>
<p>[<strong>-ref</strong> <em>value</em>] [<strong>-secret</strong>
<em>arg</em>] [<strong>-cert</strong> <em>filename</em>|<em>uri</em>]
[<strong>-own_trusted</strong> <em>filenames</em>|<em>uris</em>]
[<strong>-key</strong> <em>filename</em>|<em>uri</em>]
[<strong>-keypass</strong> <em>arg</em>] [<strong>-digest</strong>
<em>name</em>] [<strong>-mac</strong> <em>name</em>]
[<strong>-extracerts</strong> <em>filenames</em>|<em>uris</em>]
[<strong>-unprotected_requests</strong>]</p>
<p>Credentials format options:</p>
<p>[<strong>-certform</strong> <em>PEM|DER</em>]
[<strong>-keyform</strong> <em>PEM|DER|P12|ENGINE</em>]
[<strong>-otherpass</strong> <em>arg</em>] [<strong>-engine</strong>
<em>id</em>] [<strong>-provider</strong> <em>name</em>]
[<strong>-provider-path</strong> <em>path</em>]
[<strong>-propquery</strong> <em>propq</em>]</p>
<p>Random state options:</p>
<p>[<strong>-rand</strong> <em>files</em>] [<strong>-writerand</strong>
<em>file</em>]</p>
<p>TLS connection options:</p>
<p>[<strong>-tls_used</strong>] [<strong>-tls_cert</strong>
<em>filename</em>|<em>uri</em>] [<strong>-tls_key</strong>
<em>filename</em>|<em>uri</em>] [<strong>-tls_keypass</strong>
<em>arg</em>] [<strong>-tls_extra</strong>
<em>filenames</em>|<em>uris</em>] [<strong>-tls_trusted</strong>
<em>filenames</em>|<em>uris</em>] [<strong>-tls_host</strong>
<em>name</em>]</p>
<p>Client-side debugging options:</p>
<p>[<strong>-batch</strong>] [<strong>-repeat</strong> <em>number</em>]
[<strong>-reqin</strong> <em>filenames</em>]
[<strong>-reqin_new_tid</strong>] [<strong>-reqout</strong>
<em>filenames</em>] [<strong>-rspin</strong> <em>filenames</em>]
[<strong>-rspout</strong> <em>filenames</em>]
[<strong>-use_mock_srv</strong>]</p>
<p>Mock server options:</p>
<p>[<strong>-port</strong> <em>number</em>] [<strong>-max_msgs</strong>
<em>number</em>] [<strong>-srv_ref</strong> <em>value</em>]
[<strong>-srv_secret</strong> <em>arg</em>] [<strong>-srv_cert</strong>
<em>filename</em>|<em>uri</em>] [<strong>-srv_key</strong>
<em>filename</em>|<em>uri</em>] [<strong>-srv_keypass</strong>
<em>arg</em>] [<strong>-srv_trusted</strong>
<em>filenames</em>|<em>uris</em>] [<strong>-srv_untrusted</strong>
<em>filenames</em>|<em>uris</em>] [<strong>-rsp_cert</strong>
<em>filename</em>|<em>uri</em>] [<strong>-rsp_extracerts</strong>
<em>filenames</em>|<em>uris</em>] [<strong>-rsp_capubs</strong>
<em>filenames</em>|<em>uris</em>] [<strong>-poll_count</strong>
<em>number</em>] [<strong>-check_after</strong> <em>number</em>]
[<strong>-grant_implicitconf</strong>] [<strong>-pkistatus</strong>
<em>number</em>] [<strong>-failure</strong> <em>number</em>]
[<strong>-failurebits</strong> <em>number</em>]
[<strong>-statusstring</strong> <em>arg</em>]
[<strong>-send_error</strong>] [<strong>-send_unprotected</strong>]
[<strong>-send_unprot_err</strong>]
[<strong>-accept_unprotected</strong>]
[<strong>-accept_unprot_err</strong>]
[<strong>-accept_raverified</strong>]</p>
<p>Certificate verification options, for both CMP and TLS:</p>
<p>[<strong>-allow_proxy_certs</strong>] [<strong>-attime</strong>
<em>timestamp</em>] [<strong>-no_check_time</strong>]
[<strong>-check_ss_sig</strong>] [<strong>-crl_check</strong>]
[<strong>-crl_check_all</strong>] [<strong>-explicit_policy</strong>]
[<strong>-extended_crl</strong>] [<strong>-ignore_critical</strong>]
[<strong>-inhibit_any</strong>] [<strong>-inhibit_map</strong>]
[<strong>-partial_chain</strong>] [<strong>-policy</strong>
<em>arg</em>] [<strong>-policy_check</strong>]
[<strong>-policy_print</strong>] [<strong>-purpose</strong>
<em>purpose</em>] [<strong>-suiteB_128</strong>]
[<strong>-suiteB_128_only</strong>] [<strong>-suiteB_192</strong>]
[<strong>-trusted_first</strong>] [<strong>-no_alt_chains</strong>]
[<strong>-use_deltas</strong>] [<strong>-auth_level</strong>
<em>num</em>] [<strong>-verify_depth</strong> <em>num</em>]
[<strong>-verify_email</strong> <em>email</em>]
[<strong>-verify_hostname</strong> <em>hostname</em>]
[<strong>-verify_ip</strong> <em>ip</em>] [<strong>-verify_name</strong>
<em>name</em>] [<strong>-x509_strict</strong>]
[<strong>-issuer_checks</strong>]</p>
<h1>DESCRIPTION</h1>
<p>The <strong>cmp</strong> command is a client implementation for the
Certificate Management Protocol (CMP) as defined in RFC4210. It can be
used to request certificates from a CA server, update their
certificates, request certificates to be revoked, and perform other
types of CMP requests.</p>
<h1>OPTIONS</h1>
<dl>
<dt>-help</dt>
<dd>
<p>Display a summary of all options</p>
</dd>
<dt>-config filename</dt>
<dd>
<p>Configuration file to use. An empty string <code>""</code> means
none. Default filename is from the environment variable
<code>OPENSSL_CONF</code>.</p>
</dd>
<dt>-section names</dt>
<dd>
<p>Section(s) to use within config file defining CMP options. An empty
string <code>""</code> means no specific section. Default is
<code>cmp</code>. Multiple section names may be given, separated by
commas and/or whitespace (where in the latter case the whole argument
must be enclosed in ...). Contents of sections named later may override
contents of sections named before. In any case, as usual, the
<code>[default]</code> section and finally the unnamed section (as far
as present) can provide per-option fallback values.</p>
</dd>
<dt>-verbosity level</dt>
<dd>
<p>Level of verbosity for logging, error output, etc. 0 = EMERG, 1 =
ALERT, 2 = CRIT, 3 = ERR, 4 = WARN, 5 = NOTE, 6 = INFO, 7 = DEBUG, 8 =
TRACE. Defaults to 6 = INFO.</p>
</dd>
</dl>
<h2>Generic message options</h2>
<dl>
<dt>-cmd ir|cr|kur|p10cr|rr|genm</dt>
<dd>
<p>CMP command to execute. Currently implemented commands are:</p>
<dl>
<dt>ir - Initialization Request</dt>
<dd>

</dd>
</dl>
<dl>
<dt>cr - Certificate Request</dt>
<dd>

</dd>
<dt>p10cr - PKCS#10 Certification Request (for legacy support)</dt>
<dd>

</dd>
<dt>kur - Key Update Request</dt>
<dd>

</dd>
<dt>rr - Revocation Request</dt>
<dd>

</dd>
<dt>genm - General Message</dt>
<dd>

</dd>
</dl>
<p><strong>ir</strong> requests initialization of an end entity into a
PKI hierarchy by issuing a first certificate. <strong>cr</strong>
requests issuing an additional certificate for an end entity already
initialized to the PKI hierarchy. <strong>p10cr</strong> requests
issuing an additional certificate similarly to <strong>cr</strong> but
using legacy PKCS#10 CSR format. <strong>kur</strong> requests a (key)
update for an existing certificate. <strong>rr</strong> requests
revocation of an existing certificate. <strong>genm</strong> requests
information using a General Message, where optionally included
<strong>InfoTypeAndValue</strong>s may be used to state which info is of
interest. Upon receipt of the General Response, information about all
received ITAV <strong>infoType</strong>s is printed to stdout.</p>
</dd>
<dt>-infotype name</dt>
<dd>
<p>Set InfoType name to use for requesting specific info in
<strong>genm</strong>, e.g., <code>signKeyPairTypes</code>.</p>
</dd>
<dt>-geninfo OID:int:N</dt>
<dd>
<p>generalInfo integer values to place in request PKIHeader with given
OID, e.g., <code>1.2.3.4:int:56789</code>.</p>
</dd>
</dl>
<h2>Certificate enrollment options</h2>
<dl>
<dt>-newkey filename|uri</dt>
<dd>
<p>The source of the private or public key for the certificate being
requested. Defaults to the public key in the PKCS#10 CSR given with the
<strong>-csr</strong> option, the public key of the reference
certificate, or the current client key. The public portion of the key is
placed in the certification request. Unless <strong>-cmd</strong>
<em>p10cr</em>, <strong>-popo</strong> <em>-1</em>, or
<strong>-popo</strong> <em>0</em> is given, the private key will be
needed as well to provide the proof of possession (POPO), where the
<strong>-key</strong> option may provide a fallback.</p>
</dd>
<dt>-newkeypass arg</dt>
<dd>
<p>Pass phrase source for the key given with the
<strong>-newkey</strong> option. If not given here, the password will be
prompted for if needed. For more information about the format of
<em>arg</em> see <strong>openssl-passphrase-options</strong> (1).</p>
</dd>
<dt>-subject name</dt>
<dd>
<p>X509 Distinguished Name (DN) of subject to use in the requested
certificate template. If the NULL-DN (<code>"/"</code>) is given then no
subject is placed in the template. Default is the subject DN of any
PKCS#10 CSR given with the <strong>-csr</strong> option. For KUR, a
further fallback is the subject DN of the reference certificate (see
<strong>-oldcert</strong>) if provided. This fallback is used for IR and
CR only if no SANs are set. If provided and neither
<strong>-cert</strong> nor <strong>-oldcert</strong> is given, the
subject DN is used as fallback sender of outgoing CMP messages. The
argument must be formatted as
<em>/type0=value0/type1=value1/type2=...</em>. Special characters may be
escaped by <code>\</code> (backslash); whitespace is retained. Empty
values are permitted, but the corresponding type will not be included.
Giving a single <code>/</code> will lead to an empty sequence of RDNs (a
NULL-DN). Multi-valued RDNs can be formed by placing a <code>+</code>
character instead of a <code>/</code> between the
AttributeValueAssertions (AVAs) that specify the members of the set.
Example:
<code>/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe</code></p>
</dd>
<dt>-issuer name</dt>
<dd>
<p>X509 issuer Distinguished Name (DN) of the CA server to place in the
requested certificate template in IR/CR/KUR. If the NULL-DN
(<code>"/"</code>) is given then no issuer is placed in the template. If
provided and neither <strong>-recipient</strong> nor
<strong>-srvcert</strong> is given, the issuer DN is used as fallback
recipient of outgoing CMP messages. The argument must be formatted as
<em>/type0=value0/type1=value1/type2=...</em>. For details see the
description of the <strong>-subject</strong> option.</p>
</dd>
<dt>-days number</dt>
<dd>
<p>Number of days the new certificate is requested to be valid for,
counting from the current time of the host. Also triggers the explicit
request that the validity period starts from the current time (as seen
by the host).</p>
</dd>
<dt>-reqexts name</dt>
<dd>
<p>Name of section in OpenSSL config file defining certificate request
extensions. If the <strong>-csr</strong> option is present, these
extensions augment the extensions contained the given PKCS#10 CSR,
overriding any extensions with same OIDs.</p>
</dd>
<dt>-sans spec</dt>
<dd>
<p>One or more IP addresses, DNS names, or URIs separated by commas or
whitespace (where in the latter case the whole argument must be enclosed
in ...) to add as Subject Alternative Name(s) (SAN) certificate request
extension. If the special element critical is given the SANs are flagged
as critical. Cannot be used if any Subject Alternative Name extension is
set via <strong>-reqexts</strong>.</p>
</dd>
<dt>-san_nodefault</dt>
<dd>
<p>When Subject Alternative Names are not given via
<strong>-sans</strong> nor defined via <strong>-reqexts</strong>, they
are copied by default from the reference certificate (see
<strong>-oldcert</strong>). This can be disabled by giving the
<strong>-san_nodefault</strong> option.</p>
</dd>
<dt>-policies name</dt>
<dd>
<p>Name of section in OpenSSL config file defining policies to be set as
certificate request extension. This option cannot be used together with
<strong>-policy_oids</strong>.</p>
</dd>
<dt>-policy_oids names</dt>
<dd>
<p>One or more OID(s), separated by commas and/or whitespace (where in
the latter case the whole argument must be enclosed in ...) to add as
certificate policies request extension. This option cannot be used
together with <strong>-policies</strong>.</p>
</dd>
<dt>-policy_oids_critical</dt>
<dd>
<p>Flag the policies given with <strong>-policy_oids</strong> as
critical.</p>
</dd>
<dt>-popo number</dt>
<dd>
<p>Proof-of-possession (POPO) method to use for IR/CR/KUR; values:
<code>-1</code>..&lt;2&gt; where <code>-1</code> = NONE, <code>0</code>
= RAVERIFIED, <code>1</code> = SIGNATURE (default), <code>2</code> =
KEYENC. Note that a signature-based POPO can only be produced if a
private key is provided via the <strong>-newkey</strong> or
<strong>-key</strong> options.</p>
</dd>
<dt>-csr filename</dt>
<dd>
<p>PKCS#10 CSR in PEM or DER format containing a certificate request.
With <strong>-cmd</strong> <em>p10cr</em> it is used directly in a
legacy P10CR message. When used with <strong>-cmd</strong> <em>ir</em>,
<em>cr</em>, or <em>kur</em>, it is transformed into the respective
regular CMP request. In this case, a private key must be provided (with
<strong>-newkey</strong> or <strong>-key</strong>) for the proof of
possession (unless <strong>-popo</strong> <em>-1</em> or
<strong>-popo</strong> <em>0</em> is used) and the respective public key
is placed in the certification request (rather than taking over the
public key contained in the PKCS#10 CSR). PKCS#10 CSR input may also be
used with <strong>-cmd</strong> <em>rr</em> to specify the certificate
to be revoked via the included subject name and public key.</p>
</dd>
<dt>-out_trusted filenames|uris</dt>
<dd>
<p>Trusted certificate(s) to use for validating the newly enrolled
certificate. During this verification, any certificate status checking
is disabled. Multiple sources may be given, separated by commas and/or
whitespace (where in the latter case the whole argument must be enclosed
in ...). Each source may contain multiple certificates. The certificate
verification options <strong>-verify_hostname</strong>,
<strong>-verify_ip</strong>, and <strong>-verify_email</strong> only
affect the certificate verification enabled via this option.</p>
</dd>
<dt>-implicit_confirm</dt>
<dd>
<p>Request implicit confirmation of newly enrolled certificates.</p>
</dd>
<dt>-disable_confirm</dt>
<dd>
<p>Do not send certificate confirmation message for newly enrolled
certificate without requesting implicit confirmation to cope with broken
servers not supporting implicit confirmation correctly.
<strong>WARNING:</strong> This leads to behavior violating RFC 4210.</p>
</dd>
<dt>-certout filename</dt>
<dd>
<p>The file where the newly enrolled certificate should be saved.</p>
</dd>
<dt>-chainout filename</dt>
<dd>
<p>The file where the chain of the newly enrolled certificate should be
saved.</p>
</dd>
</dl>
<h2>Certificate enrollment and revocation options</h2>
<dl>
<dt>-oldcert filename|uri</dt>
<dd>
<p>The certificate to be updated (i.e., renewed or re-keyed) in Key
Update Request (KUR) messages or to be revoked in Revocation Request
(RR) messages. For KUR the certificate to be updated defaults to
<strong>-cert</strong>, and the resulting certificate is called
<em>reference certificate</em>. For RR the certificate to be revoked can
also be specified using <strong>-csr</strong>. The reference
certificate, if any, is also used for deriving default subject DN and
Subject Alternative Names and the default issuer entry in the requested
certificate template of an IR/CR/KUR. Its public key is used as a
fallback in the template of certification requests. Its subject is used
as sender of outgoing messages if <strong>-cert</strong> is not given.
Its issuer is used as default recipient in CMP message headers if
neither <strong>-recipient</strong>, <strong>-srvcert</strong>, nor
<strong>-issuer</strong> is given.</p>
</dd>
<dt>-revreason number</dt>
<dd>
<p>Set CRLReason to be included in revocation request (RR); values:
<code>0</code>..<code>10</code> or <code>-1</code> for none (which is
the default). Reason numbers defined in RFC 5280 are: CRLReason ::=
ENUMERATED { unspecified (0), keyCompromise (1), cACompromise (2),
affiliationChanged (3), superseded (4), cessationOfOperation (5),
certificateHold (6), -- value 7 is not used removeFromCRL (8),
privilegeWithdrawn (9), aACompromise (10) }</p>
</dd>
</dl>
<h2>Message transfer options</h2>
<dl>
<dt>-server
[http[s]://][userinfo@]host[:port][/path][?query][#fragment]</dt>
<dd>
<p>The DNS hostname or IP address and optionally port of the CMP server
to connect to using HTTP(S). This option excludes <em>-port</em> and
<em>-use_mock_srv</em>. It is ignored if <em>-rspin</em> is given with
enough filename arguments. The scheme <code>https</code> may be given
only if the <strong>-tls_used</strong> option is used. In this case the
default port is 443, else 80. The optional userinfo and fragment
components are ignored. Any given query component is handled as part of
the path component. If a path is included it provides the default value
for the <strong>-path</strong> option.</p>
</dd>
<dt>-proxy
[http[s]://][userinfo@]host[:port][/path][?query][#fragment]</dt>
<dd>
<p>The HTTP(S) proxy server to use for reaching the CMP server unless
<strong>-no_proxy</strong> applies, see below. The proxy port defaults
to 80 or 443 if the scheme is <code>https</code>; apart from that the
optional <code>http://</code> or <code>https://</code> prefix is ignored
(note that TLS may be selected by <strong>-tls_used</strong>), as well
as any path, userinfo, and query, and fragment components. Defaults to
the environment variable <code>http_proxy</code> if set, else
<code>HTTP_PROXY</code> in case no TLS is used, otherwise
<code>https_proxy</code> if set, else <code>HTTPS_PROXY</code>. This
option is ignored if <em>-server</em> is not given.</p>
</dd>
<dt>-no_proxy addresses</dt>
<dd>
<p>List of IP addresses and/or DNS names of servers not to use an
HTTP(S) proxy for, separated by commas and/or whitespace (where in the
latter case the whole argument must be enclosed in ...). Default is from
the environment variable <code>no_proxy</code> if set, else
<code>NO_PROXY</code>. This option is ignored if <em>-server</em> is not
given.</p>
</dd>
<dt>-recipient name</dt>
<dd>
<p>Distinguished Name (DN) to use in the recipient field of CMP request
message headers, i.e., the CMP server (usually the addressed CA). The
recipient field in the header of a CMP message is mandatory. If not
given explicitly the recipient is determined in the following order: the
subject of the CMP server certificate given with the
<strong>-srvcert</strong> option, the <strong>-issuer</strong> option,
the issuer of the certificate given with the <strong>-oldcert</strong>
option, the issuer of the CMP client certificate (<strong>-cert</strong>
option), as far as any of those is present, else the NULL-DN as last
resort. The argument must be formatted as
<em>/type0=value0/type1=value1/type2=...</em>. For details see the
description of the <strong>-subject</strong> option.</p>
</dd>
<dt>-path remote_path</dt>
<dd>
<p>HTTP path at the CMP server (aka CMP alias) to use for POST requests.
Defaults to any path given with <strong>-server</strong>, else
<code>"/"</code>.</p>
</dd>
<dt>-keep_alive value</dt>
<dd>
<p>If the given value is 0 then HTTP connections are not kept open after
receiving a response, which is the default behavior for HTTP 1.0. If the
value is 1 or 2 then persistent connections are requested. If the value
is 2 then persistent connections are required, i.e., in case the server
does not grant them an error occurs. The default value is 1, which means
preferring to keep the connection open.</p>
</dd>
<dt>-msg_timeout seconds</dt>
<dd>
<p>Number of seconds a CMP request-response message round trip is
allowed to take before a timeout error is returned. A value &lt;= 0
means no limitation (waiting indefinitely). Default is to use the
<strong>-total_timeout</strong> setting.</p>
</dd>
<dt>-total_timeout seconds</dt>
<dd>
<p>Maximum total number of seconds a transaction may take, including
polling etc. A value &lt;= 0 means no limitation (waiting indefinitely).
Default is 0.</p>
</dd>
</dl>
<h2>Server authentication options</h2>
<dl>
<dt>-trusted filenames|uris</dt>
<dd>
<p>The certificate(s), typically of root CAs, the client shall use as
trust anchors when validating signature-based protection of CMP response
messages. This option is ignored if the <strong>-srvcert</strong> option
is given as well. It provides more flexibility than
<strong>-srvcert</strong> because the CMP protection certificate of the
server is not pinned but may be any certificate from which a chain to
one of the given trust anchors can be constructed. If none of
<strong>-trusted</strong>, <strong>-srvcert</strong>, and
<strong>-secret</strong> is given, message validation errors will be
thrown unless <strong>-unprotected_errors</strong> permits an exception.
Multiple sources may be given, separated by commas and/or whitespace
(where in the latter case the whole argument must be enclosed in ...).
Each source may contain multiple certificates. The certificate
verification options <strong>-verify_hostname</strong>,
<strong>-verify_ip</strong>, and <strong>-verify_email</strong> have no
effect on the certificate verification enabled via this option.</p>
</dd>
<dt>-untrusted filenames|uris</dt>
<dd>
<p>Non-trusted intermediate CA certificate(s). Any extra certificates
given with the <strong>-cert</strong> option are appended to it. All
these certificates may be useful for cert path construction for the own
CMP signer certificate (to include in the extraCerts field of request
messages) and for the TLS client certificate (if TLS is enabled) as well
as for chain building when validating server certificates (checking
signature-based CMP message protection) and when validating newly
enrolled certificates. Multiple filenames or URLs may be given,
separated by commas and/or whitespace. Each source may contain multiple
certificates.</p>
</dd>
<dt>-srvcert filename|uri</dt>
<dd>
<p>The specific CMP server certificate to expect and directly trust
(even if it is expired) when verifying signature-based protection of CMP
response messages. This pins the accepted server and results in ignoring
the <strong>-trusted</strong> option. If set, the subject of the
certificate is also used as default value for the recipient of CMP
requests and as default value for the expected sender of CMP
responses.</p>
</dd>
<dt>-expect_sender name</dt>
<dd>
<p>Distinguished Name (DN) expected in the sender field of incoming CMP
messages. Defaults to the subject DN of the pinned
<strong>-srvcert</strong>, if any. This can be used to make sure that
only a particular entity is accepted as CMP message signer, and
attackers are not able to use arbitrary certificates of a trusted PKI
hierarchy to fraudulently pose as a CMP server. Note that this option
gives slightly more freedom than setting the <strong>-srvcert</strong>,
which pins the server to the holder of a particular certificate, while
the expected sender name will continue to match after updates of the
server cert. The argument must be formatted as
<em>/type0=value0/type1=value1/type2=...</em>. For details see the
description of the <strong>-subject</strong> option.</p>
</dd>
<dt>-ignore_keyusage</dt>
<dd>
<p>Ignore key usage restrictions in CMP signer certificates when
validating signature-based protection of incoming CMP messages. By
default, <code>digitalSignature</code> must be allowed by CMP signer
certificates.</p>
</dd>
<dt>-unprotected_errors</dt>
<dd>
<p>Accept missing or invalid protection of negative responses from the
server. This applies to the following message types and contents:</p>
<ul>
<li><p>error messages</p></li>
<li><p>negative certificate responses (IP/CP/KUP)</p></li>
<li><p>negative revocation responses (RP)</p></li>
<li><p>negative PKIConf messages</p></li>
</ul>
<p><strong>WARNING:</strong> This setting leads to unspecified behavior
and it is meant exclusively to allow interoperability with server
implementations violating RFC 4210, e.g.:</p>
<ul>
<li><p>section 5.1.3.1 allows exceptions from protecting only for
special cases: There MAY be cases in which the PKIProtection BIT STRING
is deliberately not used to protect a message [...] because other
protection, external to PKIX, will be applied instead.</p></li>
<li><p>section 5.3.21 is clear on ErrMsgContent: The CA MUST always sign
it with a signature key.</p></li>
<li><p>appendix D.4 shows PKIConf message having protection</p></li>
</ul>
</dd>
<dt>-extracertsout filename</dt>
<dd>
<p>The file where to save all certificates contained in the extraCerts
field of the last received response message (except for pollRep and
PKIConf).</p>
</dd>
<dt>-cacertsout filename</dt>
<dd>
<p>The file where to save any CA certificates contained in the caPubs
field of the last received certificate response (i.e., IP, CP, or KUP)
message.</p>
</dd>
</dl>
<h2>Client authentication options</h2>
<dl>
<dt>-ref value</dt>
<dd>
<p>Reference number/string/value to use as fallback senderKID; this is
required if no sender name can be determined from the
<strong>-cert</strong> or &lt;-subject&gt; options and is typically used
when authenticating with pre-shared key (password-based MAC).</p>
</dd>
<dt>-secret arg</dt>
<dd>
<p>Provides the source of a secret value to use with MAC-based message
protection. This takes precedence over the <strong>-cert</strong> and
<strong>-key</strong> options. The secret is used for creating MAC-based
protection of outgoing messages and for validating incoming messages
that have MAC-based protection. The algorithm used by default is
Password-Based Message Authentication Code (PBM) as defined in RFC 4210
section 5.1.3.1. For more information about the format of <em>arg</em>
see <strong>openssl-passphrase-options</strong> (1).</p>
</dd>
<dt>-cert filename|uri</dt>
<dd>
<p>The client's current CMP signer certificate. Requires the
corresponding key to be given with <strong>-key</strong>. The subject
and the public key contained in this certificate serve as fallback
values in the certificate template of IR/CR/KUR messages. The subject of
this certificate will be used as sender of outgoing CMP messages, while
the subject of <strong>-oldcert</strong> or
<strong>-subjectName</strong> may provide fallback values. The issuer of
this certificate is used as one of the recipient fallback values and as
fallback issuer entry in the certificate template of IR/CR/KUR messages.
When performing signature-based message protection, this protection
certificate, also called signer certificate, will be included first in
the extraCerts field of outgoing messages and the signature is done with
the corresponding key. In Initialization Request (IR) messages this can
be used for authenticating using an external entity certificate as
defined in appendix E.7 of RFC 4210. For Key Update Request (KUR)
messages this is also used as the certificate to be updated if the
<strong>-oldcert</strong> option is not given. If the file includes
further certs, they are appended to the untrusted certs because they
typically constitute the chain of the client certificate, which is
included in the extraCerts field in signature-protected request
messages.</p>
</dd>
<dt>-own_trusted filenames|uris</dt>
<dd>
<p>If this list of certificates is provided then the chain built for the
client-side CMP signer certificate given with the <strong>-cert</strong>
option is verified using the given certificates as trust anchors.
Multiple sources may be given, separated by commas and/or whitespace
(where in the latter case the whole argument must be enclosed in ...).
Each source may contain multiple certificates. The certificate
verification options <strong>-verify_hostname</strong>,
<strong>-verify_ip</strong>, and <strong>-verify_email</strong> have no
effect on the certificate verification enabled via this option.</p>
</dd>
<dt>-key filename|uri</dt>
<dd>
<p>The corresponding private key file for the client's current
certificate given in the <strong>-cert</strong> option. This will be
used for signature-based message protection unless the
<strong>-secret</strong> option indicating MAC-based protection or
<strong>-unprotected_requests</strong> is given. It is also used as a
fallback for the <strong>-newkey</strong> option with IR/CR/KUR
messages.</p>
</dd>
<dt>-keypass arg</dt>
<dd>
<p>Pass phrase source for the private key given with the
<strong>-key</strong> option. Also used for <strong>-cert</strong> and
<strong>-oldcert</strong> in case it is an encrypted PKCS#12 file. If
not given here, the password will be prompted for if needed. For more
information about the format of <em>arg</em> see
<strong>openssl-passphrase-options</strong> (1).</p>
</dd>
<dt>-digest name</dt>
<dd>
<p>Specifies name of supported digest to use in RFC 4210's MSG_SIG_ALG
and as the one-way function (OWF) in <code>MSG_MAC_ALG</code>. If
applicable, this is used for message protection and proof-of-possession
(POPO) signatures. To see the list of supported digests, use
<code>openssl list -digest-commands</code>. Defaults to
<code>sha256</code>.</p>
</dd>
<dt>-mac name</dt>
<dd>
<p>Specifies the name of the MAC algorithm in <code>MSG_MAC_ALG</code>.
To get the names of supported MAC algorithms use
<code>openssl list -mac-algorithms</code> and possibly combine such a
name with the name of a supported digest algorithm, e.g.,
hmacWithSHA256. Defaults to <code>hmac-sha1</code> as per RFC 4210.</p>
</dd>
<dt>-extracerts filenames|uris</dt>
<dd>
<p>Certificates to append in the extraCerts field when sending messages.
They can be used as the default CMP signer certificate chain to include.
Multiple sources may be given, separated by commas and/or whitespace
(where in the latter case the whole argument must be enclosed in ...).
Each source may contain multiple certificates.</p>
</dd>
<dt>-unprotected_requests</dt>
<dd>
<p>Send request messages without CMP-level protection.</p>
</dd>
</dl>
<h2>Credentials format options</h2>
<dl>
<dt>-certform PEM|DER</dt>
<dd>
<p>File format to use when saving a certificate to a file. Default value
is PEM.</p>
</dd>
<dt>-keyform PEM|DER|P12|ENGINE</dt>
<dd>
<p>The format of the key input; unspecified by default. See Format
Options in <strong>openssl</strong> (1) for details.</p>
</dd>
<dt>-otherpass arg</dt>
<dd>
<p>Pass phrase source for certificate given with the
<strong>-trusted</strong>, <strong>-untrusted</strong>,
<strong>-own_trusted</strong>, <strong>-srvcert</strong>,
<strong>-out_trusted</strong>, <strong>-extracerts</strong>,
<strong>-srv_trusted</strong>, <strong>-srv_untrusted</strong>,
<strong>-rsp_extracerts</strong>, <strong>-rsp_capubs</strong>,
<strong>-tls_extra</strong>, and <strong>-tls_trusted</strong> options.
If not given here, the password will be prompted for if needed. For more
information about the format of <em>arg</em> see
<strong>openssl-passphrase-options</strong> (1).</p>
</dd>
<dt>-engine id</dt>
<dd>
<p>See Engine Options in <strong>openssl</strong> (1). This option is
deprecated. As an alternative to using this combination: -engine
{engineid} -key {keyid} -keyform ENGINE ... it's also possible to just
give the key ID in URI form to <strong>-key</strong>, like this: -key
org.openssl.engine:{engineid}:{keyid} This applies to all options
specifying keys: <strong>-key</strong>, <strong>-newkey</strong>, and
<strong>-tls_key</strong>.</p>
</dd>
</dl>
<h2>Provider options</h2>
<dl>
<dt>-provider name</dt>
<dd>

</dd>
</dl>
<dl>
<dt>-provider-path path</dt>
<dd>

</dd>
<dt>-propquery propq</dt>
<dd>

</dd>
</dl>
<p>See Provider Options in <strong>openssl</strong> (1),
<strong>provider</strong> (7), and <strong>property</strong> (7).</p>
<h2>Random state options</h2>
<dl>
<dt>-rand files, -writerand file</dt>
<dd>
<p>See Random State Options in <strong>openssl</strong> (1) for
details.</p>
</dd>
</dl>
<h2>TLS connection options</h2>
<dl>
<dt>-tls_used</dt>
<dd>
<p>Enable using TLS (even when other TLS-related options are not set)
for message exchange with CMP server via HTTP. This option is not
supported with the <em>-port</em> option. It is ignored if the
<em>-server</em> option is not given or <em>-use_mock_srv</em> is given
or <em>-rspin</em> is given with enough filename arguments. The
following TLS-related options are ignored if <strong>-tls_used</strong>
is not given or does not take effect.</p>
</dd>
<dt>-tls_cert filename|uri</dt>
<dd>
<p>Client's TLS certificate. If the source includes further certs they
are used (along with <strong>-untrusted</strong> certs) for constructing
the client cert chain provided to the TLS server.</p>
</dd>
<dt>-tls_key filename|uri</dt>
<dd>
<p>Private key for the client's TLS certificate.</p>
</dd>
<dt>-tls_keypass arg</dt>
<dd>
<p>Pass phrase source for client's private TLS key
<strong>-tls_key</strong>. Also used for <strong>-tls_cert</strong> in
case it is an encrypted PKCS#12 file. If not given here, the password
will be prompted for if needed. For more information about the format of
<em>arg</em> see <strong>openssl-passphrase-options</strong> (1).</p>
</dd>
<dt>-tls_extra filenames|uris</dt>
<dd>
<p>Extra certificates to provide to TLS server during TLS handshake</p>
</dd>
<dt>-tls_trusted filenames|uris</dt>
<dd>
<p>Trusted certificate(s) to use for validating the TLS server
certificate. This implies hostname validation. Multiple sources may be
given, separated by commas and/or whitespace (where in the latter case
the whole argument must be enclosed in ...). Each source may contain
multiple certificates. The certificate verification options
<strong>-verify_hostname</strong>, <strong>-verify_ip</strong>, and
<strong>-verify_email</strong> have no effect on the certificate
verification enabled via this option.</p>
</dd>
<dt>-tls_host name</dt>
<dd>
<p>Address to be checked during hostname validation. This may be a DNS
name or an IP address. If not given it defaults to the
<strong>-server</strong> address.</p>
</dd>
</dl>
<h2>Client-side debugging options</h2>
<dl>
<dt>-batch</dt>
<dd>
<p>Do not interactively prompt for input, for instance when a password
is needed. This can be useful for batch processing and testing.</p>
</dd>
<dt>-repeat number</dt>
<dd>
<p>Invoke the command the given positive number of times with the same
parameters. Default is one invocation.</p>
</dd>
<dt>-reqin filenames</dt>
<dd>
<p>Take the sequence of CMP requests to send to the server from the
given file(s) rather than from the sequence of requests produced
internally. This option is ignored if the <strong>-rspin</strong> option
is given because in the latter case no requests are actually sent.
Multiple filenames may be given, separated by commas and/or whitespace
(where in the latter case the whole argument must be enclosed in ...).
The files are read as far as needed to complete the transaction and
filenames have been provided. If more requests are needed, the remaining
ones are taken from the items at the respective position in the sequence
of requests produced internally. The client needs to update the
recipNonce field in the given requests (except for the first one) in
order to satisfy the checks to be performed by the server. This causes
re-protection (if protecting requests is required).</p>
</dd>
<dt>-reqin_new_tid</dt>
<dd>
<p>Use a fresh transactionID for CMP request messages read using
<strong>-reqin</strong>, which causes their reprotection (if protecting
requests is required). This may be needed in case the sequence of
requests is reused and the CMP server complains that the transaction ID
has already been used.</p>
</dd>
<dt>-reqout filenames</dt>
<dd>
<p>Save the sequence of CMP requests created by the client to the given
file(s). These requests are not sent to the server if the
<strong>-reqin</strong> option is used, too. Multiple filenames may be
given, separated by commas and/or whitespace. Files are written as far
as needed to save the transaction and filenames have been provided. If
the transaction contains more requests, the remaining ones are not
saved.</p>
</dd>
<dt>-rspin filenames</dt>
<dd>
<p>Process the sequence of CMP responses provided in the given file(s),
not contacting any given server, as long as enough filenames are
provided to complete the transaction. Multiple filenames may be given,
separated by commas and/or whitespace. Any server specified via the
<em>-server</em> or <em>-use_mock_srv</em> options is contacted only if
more responses are needed to complete the transaction. In this case the
transaction will fail unless the server has been prepared to continue
the already started transaction.</p>
</dd>
<dt>-rspout filenames</dt>
<dd>
<p>Save the sequence of actually used CMP responses to the given
file(s). These have been received from the server unless
<strong>-rspin</strong> takes effect. Multiple filenames may be given,
separated by commas and/or whitespace. Files are written as far as
needed to save the responses contained in the transaction and filenames
have been provided. If the transaction contains more responses, the
remaining ones are not saved.</p>
</dd>
<dt>-use_mock_srv</dt>
<dd>
<p>Test the client using the internal CMP server mock-up at API level,
bypassing socket-based transfer via HTTP. This excludes the
<strong>-server</strong> and <strong>-port</strong> options.</p>
</dd>
</dl>
<h2>Mock server options</h2>
<dl>
<dt>-port number</dt>
<dd>
<p>Act as HTTP-based CMP server mock-up listening on the given port.
This excludes the <strong>-server</strong> and
<strong>-use_mock_srv</strong> options. The <strong>-rspin</strong>,
<strong>-rspout</strong>, <strong>-reqin</strong>, and
<strong>-reqout</strong> options so far are not supported in this
mode.</p>
</dd>
<dt>-max_msgs number</dt>
<dd>
<p>Maximum number of CMP (request) messages the CMP HTTP server mock-up
should handle, which must be nonnegative. The default value is 0, which
means that no limit is imposed. In any case the server terminates on
internal errors, but not when it detects a CMP-level error that it can
successfully answer with an error message.</p>
</dd>
<dt>-srv_ref value</dt>
<dd>
<p>Reference value to use as senderKID of server in case no
<strong>-srv_cert</strong> is given.</p>
</dd>
<dt>-srv_secret arg</dt>
<dd>
<p>Password source for server authentication with a pre-shared key
(secret).</p>
</dd>
<dt>-srv_cert filename|uri</dt>
<dd>
<p>Certificate of the server.</p>
</dd>
<dt>-srv_key filename|uri</dt>
<dd>
<p>Private key used by the server for signing messages.</p>
</dd>
<dt>-srv_keypass arg</dt>
<dd>
<p>Server private key (and cert) file pass phrase source.</p>
</dd>
<dt>-srv_trusted filenames|uris</dt>
<dd>
<p>Trusted certificates for client authentication. The certificate
verification options <strong>-verify_hostname</strong>,
<strong>-verify_ip</strong>, and <strong>-verify_email</strong> have no
effect on the certificate verification enabled via this option.</p>
</dd>
<dt>-srv_untrusted filenames|uris</dt>
<dd>
<p>Intermediate CA certs that may be useful when validating client
certificates.</p>
</dd>
<dt>-rsp_cert filename|uri</dt>
<dd>
<p>Certificate to be returned as mock enrollment result.</p>
</dd>
<dt>-rsp_extracerts filenames|uris</dt>
<dd>
<p>Extra certificates to be included in mock certification
responses.</p>
</dd>
<dt>-rsp_capubs filenames|uris</dt>
<dd>
<p>CA certificates to be included in mock Initialization Response (IP)
message.</p>
</dd>
<dt>-poll_count number</dt>
<dd>
<p>Number of times the client must poll before receiving a
certificate.</p>
</dd>
<dt>-check_after number</dt>
<dd>
<p>The checkAfter value (number of seconds to wait) to include in poll
response.</p>
</dd>
<dt>-grant_implicitconf</dt>
<dd>
<p>Grant implicit confirmation of newly enrolled certificate.</p>
</dd>
<dt>-pkistatus number</dt>
<dd>
<p>PKIStatus to be included in server response. Valid range is 0
(accepted) .. 6 (keyUpdateWarning).</p>
</dd>
<dt>-failure number</dt>
<dd>
<p>A single failure info bit number to be included in server response.
Valid range is 0 (badAlg) .. 26 (duplicateCertReq).</p>
</dd>
<dt>-failurebits number Number representing failure bits to be included
in server response. Valid range is 0 .. 2^27 - 1.</dt>
<dd>

</dd>
</dl>
<dl>
<dt>-statusstring arg</dt>
<dd>

</dd>
</dl>
<p>Text to be included as status string in server response.</p>
<dl>
<dt>-send_error</dt>
<dd>
<p>Force server to reply with error message.</p>
</dd>
<dt>-send_unprotected</dt>
<dd>
<p>Send response messages without CMP-level protection.</p>
</dd>
<dt>-send_unprot_err</dt>
<dd>
<p>In case of negative responses, server shall send unprotected error
messages, certificate responses (IP/CP/KUP), and revocation responses
(RP). WARNING: This setting leads to behavior violating RFC 4210.</p>
</dd>
<dt>-accept_unprotected</dt>
<dd>
<p>Accept missing or invalid protection of requests.</p>
</dd>
<dt>-accept_unprot_err</dt>
<dd>
<p>Accept unprotected error messages from client. So far this has no
effect because the server does not accept any error messages.</p>
</dd>
<dt>-accept_raverified</dt>
<dd>
<p>Accept RAVERIFED as proof of possession (POPO).</p>
</dd>
</dl>
<h2>Certificate verification options, for both CMP and TLS</h2>
<dl>
<dt>-allow_proxy_certs, -attime, -no_check_time, -check_ss_sig,
-crl_check, -crl_check_all, -explicit_policy, -extended_crl,
-ignore_critical, -inhibit_any, -inhibit_map, -no_alt_chains,
-partial_chain, -policy, -policy_check, -policy_print, -purpose,
-suiteB_128, -suiteB_128_only, -suiteB_192, -trusted_first, -use_deltas,
-auth_level, -verify_depth, -verify_email, -verify_hostname, -verify_ip,
-verify_name, -x509_strict -issuer_checks</dt>
<dd>
<p>Set various options of certificate chain verification. See
Verification Options in
<strong>openssl-verification-options</strong> (1) for details. The
certificate verification options <strong>-verify_hostname</strong>,
<strong>-verify_ip</strong>, and <strong>-verify_email</strong> only
affect the certificate verification enabled via the
<strong>-out_trusted</strong> option.</p>
</dd>
</dl>
<h1>NOTES</h1>
<p>When a client obtains from a CMP server CA certificates that it is
going to trust, for instance via the <code>caPubs</code> field of a
certificate response, authentication of the CMP server is particularly
critical. So special care must be taken setting up server authentication
using <strong>-trusted</strong> and related options for
certificate-based authentication or <strong>-secret</strong> for
MAC-based protection.</p>
<p>When setting up CMP configurations and experimenting with enrollment
options typically various errors occur until the configuration is
correct and complete. When the CMP server reports an error the client
will by default check the protection of the CMP response message. Yet
some CMP services tend not to protect negative responses. In this case
the client will reject them, and thus their contents are not shown
although they usually contain hints that would be helpful for
diagnostics. For assisting in such cases the CMP client offers a
workaround via the <strong>-unprotected_errors</strong> option, which
allows accepting such negative messages.</p>
<h1>EXAMPLES</h1>
<h2>Simple examples using the default OpenSSL configuration file</h2>
<p>This CMP client implementation comes with demonstrative CMP sections
in the example configuration file <em>openssl/apps/openssl.cnf</em>,
which can be used to interact conveniently with the Insta Demo CA.</p>
<p>In order to enroll an initial certificate from that CA it is
sufficient to issue the following shell commands.</p>
<p>export OPENSSL_CONF=/path/to/openssl/apps/openssl.cnf</p>
<p>openssl genrsa -out insta.priv.pem openssl cmp -section insta</p>
<p>This should produce the file <em>insta.cert.pem</em> containing a new
certificate for the private key held in <em>insta.priv.pem</em>. It can
be viewed using, e.g.,</p>
<p>openssl x509 -noout -text -in insta.cert.pem</p>
<p>In case the network setup requires using an HTTP proxy it may be
given as usual via the environment variable <strong>http_proxy</strong>
or via the <strong>-proxy</strong> option in the configuration file or
the CMP command-line argument <strong>-proxy</strong>, for example</p>
<p>-proxy http://192.168.1.1:8080</p>
<p>In the Insta Demo CA scenario both clients and the server may use the
pre-shared secret <em>insta</em> and the reference value <em>3078</em>
to authenticate to each other.</p>
<p>Alternatively, CMP messages may be protected in signature-based
manner, where the trust anchor in this case is <em>insta.ca.crt</em> and
the client may use any certificate already obtained from that CA, as
specified in the <strong>[signature]</strong> section of the example
configuration. This can be used in combination with the
<strong>[insta]</strong> section simply by</p>
<p>openssl cmp -section insta,signature</p>
<p>By default the CMP IR message type is used, yet CR works equally
here. This may be specified directly at the command line:</p>
<p>openssl cmp -section insta -cmd cr</p>
<p>or by referencing in addition the <strong>[cr]</strong> section of
the example configuration:</p>
<p>openssl cmp -section insta,cr</p>
<p>In order to update the enrolled certificate one may call</p>
<p>openssl cmp -section insta,kur</p>
<p>using MAC-based protection with PBM or</p>
<p>openssl cmp -section insta,kur,signature</p>
<p>using signature-based protection.</p>
<p>In a similar way any previously enrolled certificate may be revoked
by</p>
<p>openssl cmp -section insta,rr -trusted insta.ca.crt</p>
<p>or</p>
<p>openssl cmp -section insta,rr,signature</p>
<p>Many more options can be given in the configuration file and/or on
the command line. For instance, the <strong>-reqexts</strong> CLI option
may refer to a section in the configuration file defining X.509
extensions to use in certificate requests, such as <code>v3_req</code>
in <em>openssl/apps/openssl.cnf</em>:</p>
<p>openssl cmp -section insta,cr -reqexts v3_req</p>
<h2>Certificate enrollment</h2>
<p>The following examples do not make use of a configuration file at
first. They assume that a CMP server can be contacted on the local TCP
port 80 and accepts requests under the alias <em>/pkix/</em>.</p>
<p>For enrolling its very first certificate the client generates a
client key and sends an initial request message to the local CMP server
using a pre-shared secret key for mutual authentication. In this example
the client does not have the CA certificate yet, so we specify the name
of the CA with the <strong>-recipient</strong> option and save any CA
certificates that we may receive in the <code>capubs.pem</code>
file.</p>
<p>In below command line usage examples the <code>\</code> at line ends
is used just for formatting; each of the command invocations should be
on a single line.</p>
<p>openssl genrsa -out cl_key.pem openssl cmp -cmd ir -server
127.0.0.1:80/pkix/ -recipient "/CN=CMPserver" \ -ref 1234 -secret
pass:1234-5678 \ -newkey cl_key.pem -subject "/CN=MyName" \ -cacertsout
capubs.pem -certout cl_cert.pem</p>
<h2>Certificate update</h2>
<p>Then, when the client certificate and its related key pair needs to
be updated, the client can send a key update request taking the certs in
<code>capubs.pem</code> as trusted for authenticating the server and
using the previous cert and key for its own authentication. Then it can
start using the new cert and key.</p>
<p>openssl genrsa -out cl_key_new.pem openssl cmp -cmd kur -server
127.0.0.1:80/pkix/ \ -trusted capubs.pem \ -cert cl_cert.pem -key
cl_key.pem \ -newkey cl_key_new.pem -certout cl_cert.pem cp
cl_key_new.pem cl_key.pem</p>
<p>This command sequence can be repeated as often as needed.</p>
<h2>Requesting information from CMP server</h2>
<p>Requesting all relevant information with an empty General Message.
This prints information about all received ITAV
<strong>infoType</strong>s to stdout.</p>
<p>openssl cmp -cmd genm -server 127.0.0.1/pkix/ -recipient
"/CN=CMPserver" \ -ref 1234 -secret pass:1234-5678</p>
<h2>Using a custom configuration file</h2>
<p>For CMP client invocations, in particular for certificate enrollment,
usually many parameters need to be set, which is tedious and error-prone
to do on the command line. Therefore, the client offers the possibility
to read options from sections of the OpenSSL config file, usually called
<em>openssl.cnf</em>. The values found there can still be extended and
even overridden by any subsequently loaded sections and on the command
line.</p>
<p>After including in the configuration file the following sections:</p>
<p>[cmp] server = 127.0.0.1 path = pkix/ trusted = capubs.pem cert =
cl_cert.pem key = cl_key.pem newkey = cl_key.pem certout = cl_cert.pem
[init] recipient = "/CN=CMPserver" trusted = cert = key = ref = 1234
secret = pass:1234-5678-1234-567 subject = "/CN=MyName" cacertsout =
capubs.pem</p>
<p>the above enrollment transactions reduce to</p>
<p>openssl cmp -section cmp,init openssl cmp -cmd kur -newkey
cl_key_new.pem</p>
<p>and the above transaction using a general message reduces to</p>
<p>openssl cmp -section cmp,init -cmd genm</p>
<h1>SEE ALSO</h1>
<p><strong>openssl-genrsa</strong> (1),
<strong>openssl-ecparam</strong> (1), <strong>openssl-list</strong> (1),
<strong>openssl-req</strong> (1), <strong>openssl-x509</strong> (1),
<strong>x509v3_config</strong> (5)</p>
<h1>HISTORY</h1>
<p>The <strong>cmp</strong> application was added in OpenSSL 3.0.</p>
<p>The <strong>-engine option</strong> was deprecated in OpenSSL
3.0.</p>
<h1>COPYRIGHT</h1>
<p>Copyright 2007-2023 The OpenSSL Project Authors. All Rights
Reserved.</p>
<p>Licensed under the Apache License 2.0 (the License). You may not use
this file except in compliance with the License. You can obtain a copy
in the file LICENSE in the source distribution or at
&lt;https://www.openssl.org/source/license.html&gt;.</p>
