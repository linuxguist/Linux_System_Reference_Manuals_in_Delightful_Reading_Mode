<pre><code></code></pre>
<p><br />
</p>
<link rel='stylesheet' href='../style.css'>
<script src='../script.js'></script>
<h1>NAME</h1>
<p>openssl-ca - sample minimal CA application</p>
<h1>SYNOPSIS</h1>
<p><strong>openssl</strong> <strong>ca</strong> [<strong>-help</strong>]
[<strong>-verbose</strong>] [<strong>-config</strong> <em>filename</em>]
[<strong>-name</strong> <em>section</em>] [<strong>-section</strong>
<em>section</em>] [<strong>-gencrl</strong>] [<strong>-revoke</strong>
<em>file</em>] [<strong>-valid</strong> <em>file</em>]
[<strong>-status</strong> <em>serial</em>] [<strong>-updatedb</strong>]
[<strong>-crl_reason</strong> <em>reason</em>]
[<strong>-crl_hold</strong> <em>instruction</em>]
[<strong>-crl_compromise</strong> <em>time</em>]
[<strong>-crl_CA_compromise</strong> <em>time</em>]
[<strong>-crl_lastupdate</strong> <em>date</em>]
[<strong>-crl_nextupdate</strong> <em>date</em>]
[<strong>-crldays</strong> <em>days</em>] [<strong>-crlhours</strong>
<em>hours</em>] [<strong>-crlsec</strong> <em>seconds</em>]
[<strong>-crlexts</strong> <em>section</em>]
[<strong>-startdate</strong> <em>date</em>] [<strong>-enddate</strong>
<em>date</em>] [<strong>-days</strong> <em>arg</em>]
[<strong>-md</strong> <em>arg</em>] [<strong>-policy</strong>
<em>arg</em>] [<strong>-keyfile</strong> <em>filename</em>|<em>uri</em>]
[<strong>-keyform</strong>
<strong>DER</strong>|<strong>PEM</strong>|<strong>P12</strong>|<strong>ENGINE</strong>]
[<strong>-key</strong> <em>arg</em>] [<strong>-passin</strong>
<em>arg</em>] [<strong>-cert</strong> <em>file</em>]
[<strong>-certform</strong>
<strong>DER</strong>|<strong>PEM</strong>|<strong>P12</strong>]
[<strong>-selfsign</strong>] [<strong>-in</strong> <em>file</em>]
[<strong>-inform</strong> <strong>DER</strong>|&lt;PEM&gt;]
[<strong>-out</strong> <em>file</em>] [<strong>-notext</strong>]
[<strong>-dateopt</strong>] [<strong>-outdir</strong> <em>dir</em>]
[<strong>-infiles</strong>] [<strong>-spkac</strong> <em>file</em>]
[<strong>-ss_cert</strong> <em>file</em>] [<strong>-preserveDN</strong>]
[<strong>-noemailDN</strong>] [<strong>-batch</strong>]
[<strong>-msie_hack</strong>] [<strong>-extensions</strong>
<em>section</em>] [<strong>-extfile</strong> <em>section</em>]
[<strong>-subj</strong> <em>arg</em>] [<strong>-utf8</strong>]
[<strong>-sigopt</strong> <em>nm</em>:<em>v</em>]
[<strong>-vfyopt</strong> <em>nm</em>:<em>v</em>]
[<strong>-create_serial</strong>] [<strong>-rand_serial</strong>]
[<strong>-multivalue-rdn</strong>] [<strong>-rand</strong>
<em>files</em>] [<strong>-writerand</strong> <em>file</em>]
[<strong>-engine</strong> <em>id</em>] [<strong>-provider</strong>
<em>name</em>] [<strong>-provider-path</strong> <em>path</em>]
[<strong>-propquery</strong> <em>propq</em>] [<em>certreq</em>...]</p>
<h1>DESCRIPTION</h1>
<p>This command emulates a CA application. See the
<strong>WARNINGS</strong> especially when considering to use it
productively. It can be used to sign certificate requests (CSRs) in a
variety of forms and generate certificate revocation lists (CRLs). It
also maintains a text database of issued certificates and their status.
When signing certificates, a single request can be specified with the
<strong>-in</strong> option, or multiple requests can be processed by
specifying a set of <strong>certreq</strong> files after all
options.</p>
<p>Note that there are also very lean ways of generating certificates:
the <strong>req</strong> and <strong>x509</strong> commands can be used
for directly creating certificates. See <strong>openssl-req</strong> (1)
and <strong>openssl-x509</strong> (1) for details.</p>
<p>The descriptions of the <strong>ca</strong> command options are
divided into each purpose.</p>
<h1>OPTIONS</h1>
<dl>
<dt>-help</dt>
<dd>
<p>Print out a usage message.</p>
</dd>
<dt>-verbose</dt>
<dd>
<p>This prints extra details about the operations being performed.</p>
</dd>
<dt>-config filename</dt>
<dd>
<p>Specifies the configuration file to use. Optional; for a description
of the default value, see COMMAND SUMMARY in
<strong>openssl</strong> (1).</p>
</dd>
<dt>-name section, -section section</dt>
<dd>
<p>Specifies the configuration file section to use (overrides
<strong>default_ca</strong> in the <strong>ca</strong> section).</p>
</dd>
<dt>-in filename</dt>
<dd>
<p>An input filename containing a single certificate request (CSR) to be
signed by the CA.</p>
</dd>
<dt>-inform DER|PEM</dt>
<dd>
<p>The format of the data in certificate request input files;
unspecified by default. See <strong>openssl-format-options</strong> (1)
for details.</p>
</dd>
<dt>-ss_cert filename</dt>
<dd>
<p>A single self-signed certificate to be signed by the CA.</p>
</dd>
<dt>-spkac filename</dt>
<dd>
<p>A file containing a single Netscape signed public key and challenge
and additional field values to be signed by the CA. See the
<strong>SPKAC FORMAT</strong> section for information on the required
input and output format.</p>
</dd>
<dt>-infiles</dt>
<dd>
<p>If present this should be the last option, all subsequent arguments
are taken as the names of files containing certificate requests.</p>
</dd>
<dt>-out filename</dt>
<dd>
<p>The output file to output certificates to. The default is standard
output. The certificate details will also be printed out to this file in
PEM format (except that <strong>-spkac</strong> outputs DER format).</p>
</dd>
<dt>-outdir directory</dt>
<dd>
<p>The directory to output certificates to. The certificate will be
written to a filename consisting of the serial number in hex with
<em>.pem</em> appended.</p>
</dd>
<dt>-cert filename</dt>
<dd>
<p>The CA certificate, which must match with
<strong>-keyfile</strong>.</p>
</dd>
<dt>-certform DER|PEM|P12</dt>
<dd>
<p>The format of the data in certificate input files; unspecified by
default. See <strong>openssl-format-options</strong> (1) for
details.</p>
</dd>
<dt>-keyfile filename|uri</dt>
<dd>
<p>The CA private key to sign certificate requests with. This must match
with <strong>-cert</strong>.</p>
</dd>
<dt>-keyform DER|PEM|P12|ENGINE</dt>
<dd>
<p>The format of the private key input file; unspecified by default. See
<strong>openssl-format-options</strong> (1) for details.</p>
</dd>
<dt>-sigopt nm:v</dt>
<dd>
<p>Pass options to the signature algorithm during sign operations. Names
and values of these options are algorithm-specific.</p>
</dd>
<dt>-vfyopt nm:v</dt>
<dd>
<p>Pass options to the signature algorithm during verify operations.
Names and values of these options are algorithm-specific. This often
needs to be given while signing too, because the self-signature of a
certificate signing request (CSR) is verified against the included
public key, and that verification may need its own set of options.</p>
</dd>
<dt>-key password</dt>
<dd>
<p>The password used to encrypt the private key. Since on some systems
the command line arguments are visible (e.g., when using
<strong>ps</strong> (1) on Unix), this option should be used with
caution. Better use <strong>-passin</strong>.</p>
</dd>
<dt>-passin arg</dt>
<dd>
<p>The key password source for key files and certificate PKCS#12 files.
For more information about the format of <strong>arg</strong> see
<strong>openssl-passphrase-options</strong> (1).</p>
</dd>
<dt>-selfsign</dt>
<dd>
<p>Indicates the issued certificates are to be signed with the key the
certificate requests were signed with (given with
<strong>-keyfile</strong>). Certificate requests signed with a different
key are ignored. If <strong>-spkac</strong>, <strong>-ss_cert</strong>
or <strong>-gencrl</strong> are given, <strong>-selfsign</strong> is
ignored. A consequence of using <strong>-selfsign</strong> is that the
self-signed certificate appears among the entries in the certificate
database (see the configuration option <strong>database</strong>), and
uses the same serial number counter as all other certificates sign with
the self-signed certificate.</p>
</dd>
<dt>-notext</dt>
<dd>
<p>Don't output the text form of a certificate to the output file.</p>
</dd>
<dt>-dateopt</dt>
<dd>
<p>Specify the date output format. Values are: rfc_822 and iso_8601.
Defaults to rfc_822.</p>
</dd>
<dt>-startdate date</dt>
<dd>
<p>This allows the start date to be explicitly set. The format of the
date is YYMMDDHHMMSSZ (the same as an ASN1 UTCTime structure), or
YYYYMMDDHHMMSSZ (the same as an ASN1 GeneralizedTime structure). In both
formats, seconds SS and timezone Z must be present.</p>
</dd>
<dt>-enddate date</dt>
<dd>
<p>This allows the expiry date to be explicitly set. The format of the
date is YYMMDDHHMMSSZ (the same as an ASN1 UTCTime structure), or
YYYYMMDDHHMMSSZ (the same as an ASN1 GeneralizedTime structure). In both
formats, seconds SS and timezone Z must be present.</p>
</dd>
<dt>-days arg</dt>
<dd>
<p>The number of days to certify the certificate for.</p>
</dd>
<dt>-md alg</dt>
<dd>
<p>The message digest to use. Any digest supported by the
<strong>openssl-dgst</strong> (1) command can be used. For signing
algorithms that do not support a digest (i.e. Ed25519 and Ed448) any
message digest that is set is ignored. This option also applies to
CRLs.</p>
</dd>
<dt>-policy arg</dt>
<dd>
<p>This option defines the CA policy to use. This is a section in the
configuration file which decides which fields should be mandatory or
match the CA certificate. Check out the <strong>POLICY FORMAT</strong>
section for more information.</p>
</dd>
<dt>-msie_hack</dt>
<dd>
<p>This is a deprecated option to make this command work with very old
versions of the IE certificate enrollment control certenr3. It used
UniversalStrings for almost everything. Since the old control has
various security bugs its use is strongly discouraged.</p>
</dd>
<dt>-preserveDN</dt>
<dd>
<p>Normally the DN order of a certificate is the same as the order of
the fields in the relevant policy section. When this option is set the
order is the same as the request. This is largely for compatibility with
the older IE enrollment control which would only accept certificates if
their DNs match the order of the request. This is not needed for
Xenroll.</p>
</dd>
<dt>-noemailDN</dt>
<dd>
<p>The DN of a certificate can contain the EMAIL field if present in the
request DN, however, it is good policy just having the e-mail set into
the altName extension of the certificate. When this option is set the
EMAIL field is removed from the certificate' subject and set only in
the, eventually present, extensions. The <strong>email_in_dn</strong>
keyword can be used in the configuration file to enable this
behaviour.</p>
</dd>
<dt>-batch</dt>
<dd>
<p>This sets the batch mode. In this mode no questions will be asked and
all certificates will be certified automatically.</p>
</dd>
<dt>-extensions section</dt>
<dd>
<p>The section of the configuration file containing certificate
extensions to be added when a certificate is issued (defaults to
<strong>x509_extensions</strong> unless the <strong>-extfile</strong>
option is used). If no X.509 extensions are specified then a V1
certificate is created, else a V3 certificate is created. See the
<strong>x509v3_config</strong> (5) manual page for details of the
extension section format.</p>
</dd>
<dt>-extfile file</dt>
<dd>
<p>An additional configuration file to read certificate extensions from
(using the default section unless the <strong>-extensions</strong>
option is also used).</p>
</dd>
<dt>-subj arg</dt>
<dd>
<p>Supersedes subject name given in the request. The arg must be
formatted as <code>/type0=value0/type1=value1/type2=...</code>. Special
characters may be escaped by <code>\</code> (backslash), whitespace is
retained. Empty values are permitted, but the corresponding type will
not be included in the resulting certificate. Giving a single
<code>/</code> will lead to an empty sequence of RDNs (a NULL-DN).
Multi-valued RDNs can be formed by placing a <code>+</code> character
instead of a <code>/</code> between the AttributeValueAssertions (AVAs)
that specify the members of the set. Example:
<code>/DC=org/DC=OpenSSL/DC=users/UID=123456+CN=John Doe</code></p>
</dd>
<dt>-utf8</dt>
<dd>
<p>This option causes field values to be interpreted as UTF8 strings, by
default they are interpreted as ASCII. This means that the field values,
whether prompted from a terminal or obtained from a configuration file,
must be valid UTF8 strings.</p>
</dd>
<dt>-create_serial</dt>
<dd>
<p>If reading serial from the text file as specified in the
configuration fails, specifying this option creates a new random serial
to be used as next serial number. To get random serial numbers, use the
<strong>-rand_serial</strong> flag instead; this should only be used for
simple error-recovery.</p>
</dd>
<dt>-rand_serial</dt>
<dd>
<p>Generate a large random number to use as the serial number. This
overrides any option or configuration to use a serial number file.</p>
</dd>
<dt>-multivalue-rdn</dt>
<dd>
<p>This option has been deprecated and has no effect.</p>
</dd>
<dt>-rand files, -writerand file</dt>
<dd>
<p>See Random State Options in <strong>openssl</strong> (1) for
details.</p>
</dd>
<dt>-engine id</dt>
<dd>
<p>See Engine Options in <strong>openssl</strong> (1). This option is
deprecated.</p>
</dd>
<dt>-provider name</dt>
<dd>

</dd>
</dl>
<dl>
<dt>-provider-path path</dt>
<dd>

</dd>
<dt>-propquery propq</dt>
<dd>

</dd>
</dl>
<p>See Provider Options in <strong>openssl</strong> (1),
<strong>provider</strong> (7), and <strong>property</strong> (7).</p>
<h1>CRL OPTIONS</h1>
<dl>
<dt>-gencrl</dt>
<dd>
<p>This option generates a CRL based on information in the index
file.</p>
</dd>
<dt>-crl_lastupdate time</dt>
<dd>
<p>Allows the value of the CRL's lastUpdate field to be explicitly set;
if this option is not present, the current time is used. Accepts times
in YYMMDDHHMMSSZ format (the same as an ASN1 UTCTime structure) or
YYYYMMDDHHMMSSZ format (the same as an ASN1 GeneralizedTime
structure).</p>
</dd>
<dt>-crl_nextupdate time</dt>
<dd>
<p>Allows the value of the CRL's nextUpdate field to be explicitly set;
if this option is present, any values given for
<strong>-crldays</strong>, <strong>-crlhours</strong> and
<strong>-crlsec</strong> are ignored. Accepts times in the same formats
as <strong>-crl_lastupdate</strong>.</p>
</dd>
<dt>-crldays num</dt>
<dd>
<p>The number of days before the next CRL is due. That is the days from
now to place in the CRL nextUpdate field.</p>
</dd>
<dt>-crlhours num</dt>
<dd>
<p>The number of hours before the next CRL is due.</p>
</dd>
<dt>-crlsec num</dt>
<dd>
<p>The number of seconds before the next CRL is due.</p>
</dd>
<dt>-revoke filename</dt>
<dd>
<p>A filename containing a certificate to revoke.</p>
</dd>
<dt>-valid filename</dt>
<dd>
<p>A filename containing a certificate to add a Valid certificate
entry.</p>
</dd>
<dt>-status serial</dt>
<dd>
<p>Displays the revocation status of the certificate with the specified
serial number and exits.</p>
</dd>
<dt>-updatedb</dt>
<dd>
<p>Updates the database index to purge expired certificates.</p>
</dd>
<dt>-crl_reason reason</dt>
<dd>
<p>Revocation reason, where <em>reason</em> is one of:
<strong>unspecified</strong>, <strong>keyCompromise</strong>,
<strong>CACompromise</strong>, <strong>affiliationChanged</strong>,
<strong>superseded</strong>, <strong>cessationOfOperation</strong>,
<strong>certificateHold</strong> or <strong>removeFromCRL</strong>. The
matching of <em>reason</em> is case insensitive. Setting any revocation
reason will make the CRL v2. In practice <strong>removeFromCRL</strong>
is not particularly useful because it is only used in delta CRLs which
are not currently implemented.</p>
</dd>
<dt>-crl_hold instruction</dt>
<dd>
<p>This sets the CRL revocation reason code to
<strong>certificateHold</strong> and the hold instruction to
<em>instruction</em> which must be an OID. Although any OID can be used
only <strong>holdInstructionNone</strong> (the use of which is
discouraged by RFC2459) <strong>holdInstructionCallIssuer</strong> or
<strong>holdInstructionReject</strong> will normally be used.</p>
</dd>
<dt>-crl_compromise time</dt>
<dd>
<p>This sets the revocation reason to <strong>keyCompromise</strong> and
the compromise time to <em>time</em>. <em>time</em> should be in
GeneralizedTime format that is <em>YYYYMMDDHHMMSSZ</em>.</p>
</dd>
<dt>-crl_CA_compromise time</dt>
<dd>
<p>This is the same as <strong>crl_compromise</strong> except the
revocation reason is set to <strong>CACompromise</strong>.</p>
</dd>
<dt>-crlexts section</dt>
<dd>
<p>The section of the configuration file containing CRL extensions to
include. If no CRL extension section is present then a V1 CRL is
created, if the CRL extension section is present (even if it is empty)
then a V2 CRL is created. The CRL extensions specified are CRL
extensions and <strong>not</strong> CRL entry extensions. It should be
noted that some software (for example Netscape) can't handle V2 CRLs.
See <strong>x509v3_config</strong> (5) manual page for details of the
extension section format.</p>
</dd>
</dl>
<h1>CONFIGURATION FILE OPTIONS</h1>
<p>The section of the configuration file containing options for this
command is found as follows: If the <strong>-name</strong> command line
option is used, then it names the section to be used. Otherwise the
section to be used must be named in the <strong>default_ca</strong>
option of the <strong>ca</strong> section of the configuration file (or
in the default section of the configuration file). Besides
<strong>default_ca</strong>, the following options are read directly
from the <strong>ca</strong> section: RANDFILE preserve msie_hack With
the exception of <strong>RANDFILE</strong>, this is probably a bug and
may change in future releases.</p>
<p>Many of the configuration file options are identical to command line
options. Where the option is present in the configuration file and the
command line the command line value is used. Where an option is
described as mandatory then it must be present in the configuration file
or the command line equivalent (if any) used.</p>
<dl>
<dt>oid_file</dt>
<dd>
<p>This specifies a file containing additional <strong>OBJECT
IDENTIFIERS</strong>. Each line of the file should consist of the
numerical form of the object identifier followed by whitespace then the
short name followed by whitespace and finally the long name.</p>
</dd>
<dt>oid_section</dt>
<dd>
<p>This specifies a section in the configuration file containing extra
object identifiers. Each line should consist of the short name of the
object identifier followed by <strong>=</strong> and the numerical form.
The short and long names are the same when this option is used.</p>
</dd>
<dt>new_certs_dir</dt>
<dd>
<p>The same as the <strong>-outdir</strong> command line option. It
specifies the directory where new certificates will be placed.
Mandatory.</p>
</dd>
<dt>certificate</dt>
<dd>
<p>The same as <strong>-cert</strong>. It gives the file containing the
CA certificate. Mandatory.</p>
</dd>
<dt>private_key</dt>
<dd>
<p>Same as the <strong>-keyfile</strong> option. The file containing the
CA private key. Mandatory.</p>
</dd>
<dt>RANDFILE</dt>
<dd>
<p>At startup the specified file is loaded into the random number
generator, and at exit 256 bytes will be written to it. (Note: Using a
RANDFILE is not necessary anymore, see the HISTORY section.</p>
</dd>
<dt>default_days</dt>
<dd>
<p>The same as the <strong>-days</strong> option. The number of days to
certify a certificate for.</p>
</dd>
<dt>default_startdate</dt>
<dd>
<p>The same as the <strong>-startdate</strong> option. The start date to
certify a certificate for. If not set the current time is used.</p>
</dd>
<dt>default_enddate</dt>
<dd>
<p>The same as the <strong>-enddate</strong> option. Either this option
or <strong>default_days</strong> (or the command line equivalents) must
be present.</p>
</dd>
<dt>default_crl_hours default_crl_days</dt>
<dd>
<p>The same as the <strong>-crlhours</strong> and the
<strong>-crldays</strong> options. These will only be used if neither
command line option is present. At least one of these must be present to
generate a CRL.</p>
</dd>
<dt>default_md</dt>
<dd>
<p>The same as the <strong>-md</strong> option. Mandatory except where
the signing algorithm does not require a digest (i.e. Ed25519 and
Ed448).</p>
</dd>
<dt>database</dt>
<dd>
<p>The text database file to use. Mandatory. This file must be present
though initially it will be empty.</p>
</dd>
<dt>unique_subject</dt>
<dd>
<p>If the value <strong>yes</strong> is given, the valid certificate
entries in the database must have unique subjects. if the value
<strong>no</strong> is given, several valid certificate entries may have
the exact same subject. The default value is <strong>yes</strong>, to be
compatible with older (pre 0.9.8) versions of OpenSSL. However, to make
CA certificate roll-over easier, it's recommended to use the value
<strong>no</strong>, especially if combined with the
<strong>-selfsign</strong> command line option. Note that it is valid in
some circumstances for certificates to be created without any subject.
In the case where there are multiple certificates without subjects this
does not count as a duplicate.</p>
</dd>
<dt>serial</dt>
<dd>
<p>A text file containing the next serial number to use in hex.
Mandatory. This file must be present and contain a valid serial
number.</p>
</dd>
<dt>crlnumber</dt>
<dd>
<p>A text file containing the next CRL number to use in hex. The crl
number will be inserted in the CRLs only if this file exists. If this
file is present, it must contain a valid CRL number.</p>
</dd>
<dt>x509_extensions</dt>
<dd>
<p>A fallback to the <strong>-extensions</strong> option.</p>
</dd>
<dt>crl_extensions</dt>
<dd>
<p>A fallback to the <strong>-crlexts</strong> option.</p>
</dd>
<dt>preserve</dt>
<dd>
<p>The same as <strong>-preserveDN</strong></p>
</dd>
<dt>email_in_dn</dt>
<dd>
<p>The same as <strong>-noemailDN</strong>. If you want the EMAIL field
to be removed from the DN of the certificate simply set this to 'no'. If
not present the default is to allow for the EMAIL filed in the
certificate's DN.</p>
</dd>
<dt>msie_hack</dt>
<dd>
<p>The same as <strong>-msie_hack</strong></p>
</dd>
<dt>policy</dt>
<dd>
<p>The same as <strong>-policy</strong>. Mandatory. See the
<strong>POLICY FORMAT</strong> section for more information.</p>
</dd>
<dt>name_opt, cert_opt</dt>
<dd>
<p>These options allow the format used to display the certificate
details when asking the user to confirm signing. All the options
supported by the <strong>x509</strong> utilities
<strong>-nameopt</strong> and <strong>-certopt</strong> switches can be
used here, except the <strong>no_signame</strong> and
<strong>no_sigdump</strong> are permanently set and cannot be disabled
(this is because the certificate signature cannot be displayed because
the certificate has not been signed at this point). For convenience the
values <strong>ca_default</strong> are accepted by both to produce a
reasonable output. If neither option is present the format used in
earlier versions of OpenSSL is used. Use of the old format is
<strong>strongly</strong> discouraged because it only displays fields
mentioned in the <strong>policy</strong> section, mishandles
multicharacter string types and does not display extensions.</p>
</dd>
<dt>copy_extensions</dt>
<dd>
<p>Determines how extensions in certificate requests should be handled.
If set to <strong>none</strong> or this option is not present then
extensions are ignored and not copied to the certificate. If set to
<strong>copy</strong> then any extensions present in the request that
are not already present are copied to the certificate. If set to
<strong>copyall</strong> then all extensions in the request are copied
to the certificate: if the extension is already present in the
certificate it is deleted first. See the <strong>WARNINGS</strong>
section before using this option. The main use of this option is to
allow a certificate request to supply values for certain extensions such
as subjectAltName.</p>
</dd>
</dl>
<h1>POLICY FORMAT</h1>
<p>The policy section consists of a set of variables corresponding to
certificate DN fields. If the value is match then the field value must
match the same field in the CA certificate. If the value is supplied
then it must be present. If the value is optional then it may be
present. Any fields not mentioned in the policy section are silently
deleted, unless the <strong>-preserveDN</strong> option is set but this
can be regarded more of a quirk than intended behaviour.</p>
<h1>SPKAC FORMAT</h1>
<p>The input to the <strong>-spkac</strong> command line option is a
Netscape signed public key and challenge. This will usually come from
the <strong>KEYGEN</strong> tag in an HTML form to create a new private
key. It is however possible to create SPKACs using
<strong>openssl-spkac</strong> (1).</p>
<p>The file should contain the variable SPKAC set to the value of the
SPKAC and also the required DN components as name value pairs. If you
need to include the same component twice then it can be preceded by a
number and a '.'.</p>
<p>When processing SPKAC format, the output is DER if the
<strong>-out</strong> flag is used, but PEM format if sending to stdout
or the <strong>-outdir</strong> flag is used.</p>
<h1>EXAMPLES</h1>
<p>Note: these examples assume that the directory structure this command
assumes is already set up and the relevant files already exist. This
usually involves creating a CA certificate and private key with
<strong>openssl-req</strong> (1), a serial number file and an empty
index file and placing them in the relevant directories.</p>
<p>To use the sample configuration file below the directories
<em>demoCA</em>, <em>demoCA/private</em> and <em>demoCA/newcerts</em>
would be created. The CA certificate would be copied to
<em>demoCA/cacert.pem</em> and its private key to
<em>demoCA/private/cakey.pem</em>. A file <em>demoCA/serial</em> would
be created containing for example 01 and the empty index file
<em>demoCA/index.txt</em>.</p>
<p>Sign a certificate request:</p>
<p>openssl ca -in req.pem -out newcert.pem</p>
<p>Sign an SM2 certificate request:</p>
<p>openssl ca -in sm2.csr -out sm2.crt -md sm3 \ -sigopt
"distid:1234567812345678" \ -vfyopt "distid:1234567812345678"</p>
<p>Sign a certificate request, using CA extensions:</p>
<p>openssl ca -in req.pem -extensions v3_ca -out newcert.pem</p>
<p>Generate a CRL</p>
<p>openssl ca -gencrl -out crl.pem</p>
<p>Sign several requests:</p>
<p>openssl ca -infiles req1.pem req2.pem req3.pem</p>
<p>Certify a Netscape SPKAC:</p>
<p>openssl ca -spkac spkac.txt</p>
<p>A sample SPKAC file (the SPKAC line has been truncated for
clarity):</p>
<p>SPKAC=MIG0MGAwXDANBgkqhkiG9w0BAQEFAANLADBIAkEAn7PDhCeV/xIxUg8V70YRxK2A5
CN=Steve Test emailAddress=steve@openssl.org 0.OU=OpenSSL Group
1.OU=Another Group</p>
<p>A sample configuration file with the relevant sections for this
command:</p>
<p>[ ca ] default_ca = CA_default # The default ca section [ CA_default
] dir = ./demoCA # top dir database = $dir/index.txt # index file.
new_certs_dir = $dir/newcerts # new certs dir certificate =
$dir/cacert.pem # The CA cert serial = $dir/serial # serial no file
#rand_serial = yes # for random serial#s private_key =
$dir/private/cakey.pem# CA private key default_days = 365 # how long to
certify for default_crl_days= 30 # how long before next CRL default_md =
md5 # md to use policy = policy_any # default policy email_in_dn = no #
Dont add the email into cert DN name_opt = ca_default # Subject name
display option cert_opt = ca_default # Certificate display option
copy_extensions = none # Dont copy extensions from request [ policy_any
] countryName = supplied stateOrProvinceName = optional organizationName
= optional organizationalUnitName = optional commonName = supplied
emailAddress = optional</p>
<h1>FILES</h1>
<p>Note: the location of all files can change either by compile time
options, configuration file entries, environment variables or command
line options. The values below reflect the default values.</p>
<p>/usr/local/ssl/lib/openssl.cnf - master configuration file ./demoCA -
main CA directory ./demoCA/cacert.pem - CA certificate
./demoCA/private/cakey.pem - CA private key ./demoCA/serial - CA serial
number file ./demoCA/serial.old - CA serial number backup file
./demoCA/index.txt - CA text database file ./demoCA/index.txt.old - CA
text database backup file ./demoCA/certs - certificate output file</p>
<h1>RESTRICTIONS</h1>
<p>The text database index file is a critical part of the process and if
corrupted it can be difficult to fix. It is theoretically possible to
rebuild the index file from all the issued certificates and a current
CRL: however there is no option to do this.</p>
<p>V2 CRL features like delta CRLs are not currently supported.</p>
<p>Although several requests can be input and handled at once it is only
possible to include one SPKAC or self-signed certificate.</p>
<h1>BUGS</h1>
<p>This command is quirky and at times downright unfriendly.</p>
<p>The use of an in-memory text database can cause problems when large
numbers of certificates are present because, as the name implies the
database has to be kept in memory.</p>
<p>This command really needs rewriting or the required functionality
exposed at either a command or interface level so that a more
user-friendly replacement could handle things properly. The script
<strong>CA.pl</strong> helps a little but not very much.</p>
<p>Any fields in a request that are not present in a policy are silently
deleted. This does not happen if the <strong>-preserveDN</strong> option
is used. To enforce the absence of the EMAIL field within the DN, as
suggested by RFCs, regardless the contents of the request' subject the
<strong>-noemailDN</strong> option can be used. The behaviour should be
more friendly and configurable.</p>
<p>Canceling some commands by refusing to certify a certificate can
create an empty file.</p>
<h1>WARNINGS</h1>
<p>This command was originally meant as an example of how to do things
in a CA. Its code does not have production quality. It was not supposed
to be used as a full blown CA itself, nevertheless some people are using
it for this purpose at least internally. When doing so, specific care
should be taken to properly secure the private key(s) used for signing
certificates. It is advisable to keep them in a secure HW storage such
as a smart card or HSM and access them via a suitable engine or crypto
provider.</p>
<p>This command command is effectively a single user command: no locking
is done on the various files and attempts to run more than one
<strong>openssl ca</strong> command on the same database can have
unpredictable results.</p>
<p>The <strong>copy_extensions</strong> option should be used with
caution. If care is not taken then it can be a security risk. For
example if a certificate request contains a basicConstraints extension
with CA:TRUE and the <strong>copy_extensions</strong> value is set to
<strong>copyall</strong> and the user does not spot this when the
certificate is displayed then this will hand the requester a valid CA
certificate. This situation can be avoided by setting
<strong>copy_extensions</strong> to <strong>copy</strong> and including
basicConstraints with CA:FALSE in the configuration file. Then if the
request contains a basicConstraints extension it will be ignored.</p>
<p>It is advisable to also include values for other extensions such as
<strong>keyUsage</strong> to prevent a request supplying its own
values.</p>
<p>Additional restrictions can be placed on the CA certificate itself.
For example if the CA certificate has:</p>
<p>basicConstraints = CA:TRUE, pathlen:0</p>
<p>then even if a certificate is issued with CA:TRUE it will not be
valid.</p>
<h1>HISTORY</h1>
<p>Since OpenSSL 1.1.1, the program follows RFC5280. Specifically,
certificate validity period (specified by any of
<strong>-startdate</strong>, <strong>-enddate</strong> and
<strong>-days</strong>) and CRL last/next update time (specified by any
of <strong>-crl_lastupdate</strong>, <strong>-crl_nextupdate</strong>,
<strong>-crldays</strong>, <strong>-crlhours</strong> and
<strong>-crlsec</strong>) will be encoded as UTCTime if the dates are
earlier than year 2049 (included), and as GeneralizedTime if the dates
are in year 2050 or later.</p>
<p>OpenSSL 1.1.1 introduced a new random generator (CSPRNG) with an
improved seeding mechanism. The new seeding mechanism makes it
unnecessary to define a RANDFILE for saving and restoring randomness.
This option is retained mainly for compatibility reasons.</p>
<p>The <strong>-section</strong> option was added in OpenSSL 3.0.0.</p>
<p>The <strong>-multivalue-rdn</strong> option has become obsolete in
OpenSSL 3.0.0 and has no effect.</p>
<p>The <strong>-engine</strong> option was deprecated in OpenSSL
3.0.</p>
<h1>SEE ALSO</h1>
<p><strong>openssl</strong> (1), <strong>openssl-req</strong> (1),
<strong>openssl-spkac</strong> (1), <strong>openssl-x509</strong> (1),
<strong>CA.pl</strong> (1), <strong>config</strong> (5),
<strong>x509v3_config</strong> (5)</p>
<h1>COPYRIGHT</h1>
<p>Copyright 2000-2021 The OpenSSL Project Authors. All Rights
Reserved.</p>
<p>Licensed under the Apache License 2.0 (the License). You may not use
this file except in compliance with the License. You can obtain a copy
in the file LICENSE in the source distribution or at
&lt;https://www.openssl.org/source/license.html&gt;.</p>
